{% extends 'base.html' %}
{% block title %}Material List{% endblock %}
{% block content %}
<h1 class="mt-4">Material List</h1>
{% if template_name %}
<p class="text-info">Editing template: {{ template_name }}</p>
{% endif %}
<a href="{{ url_for('index') }}" class="btn btn-secondary mb-3">Back</a>
<div class="form-group">
  <label for="listSelector">Choose Template:</label>
    <select id="listSelector" class="form-control" data-url="{{ url_for('material_list') }}" onchange="changeList(this.value)">
    <option value="underground" {% if list_option == 'underground' %}selected{% endif %}>Underground List</option>
    <option value="rough" {% if list_option == 'rough' %}selected{% endif %}>Rough List</option>
    <option value="final" {% if list_option == 'final' %}selected{% endif %}>Final List</option>
    <option value="new" {% if list_option == 'new' %}selected{% endif %}>New List</option>
    {% for name in custom_templates %}
      <option value="{{ name }}" {% if list_option == name %}selected{% endif %}>{{ name|capitalize }} Template</option>
    {% endfor %}
  </select>
</div>
<div class="form-group">
  <label for="lookupSupply">Choose Supply for Lookup:</label>
  <select id="lookupSupply" class="form-control">
    <option value="supply1" selected>Supply 1</option>
    <option value="supply2">Supply 2</option>
  </select>
</div>
<datalist id="supply1List">
  {% for prod in supply1_products %}
    <option value="{{ prod['Description'] }}">
  {% endfor %}
</datalist>
<form id="material-form" method="POST">
  <div class="card mb-4">
    <div class="card-header">Project Information</div>
    <div class="card-body">
      <div class="form-group">
        <label for="contractor">Contractor</label>
        <input type="text" id="contractor" name="contractor" class="form-control" placeholder="Enter contractor name">
      </div>
      <div class="form-group">
        <label for="address">Address</label>
        <input type="text" id="address" name="address" class="form-control" placeholder="Enter project address">
      </div>
      <div class="form-group">
        <label for="date">Date</label>
        <input type="date" id="date" name="date" class="form-control">
      </div>
    </div>
  </div>
  <div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Quantity</th>
        <th>Product Description</th>
        <th>Unit</th>
        <th>Last Price</th>
        <th>Total</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="material-list">
      {% for product in product_list %}
      <tr class="predetermined">
        <td><input type="number" class="form-control quantity" value="{{ product.get('quantity', 0) }}"></td>
        <td><textarea class="form-control product" rows="2">{{ product['Product Description'] }}</textarea></td>
        <td><input type="text" class="form-control unit" value="{{ product.get('Unit', product.get('unit', '')) }}"></td>
        <td><input type="number" step="0.01" class="form-control last-price" value="{{ product["Last Price"] }}" readonly></td>
        <td class="total">0.00</td>
        <td>
            <span class="btn btn-secondary drag-handle" aria-label="Drag"><i class="bi bi-arrows-move"></i></span>
            <button type="button" class="btn btn-danger remove-item" aria-label="Remove"><i class="bi bi-trash"></i></button>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
  <button type="button" class="btn btn-primary" id="add-item">Add Manual Item</button>
  <button type="button" class="btn btn-success" id="export-pdf">Export to PDF</button>
  <a href="{{ url_for('download_summary') }}" class="btn btn-info">Download PDF</a>
  <div class="input-group mt-3 mb-3">
    <input type="text" class="form-control" id="template-name" placeholder="Template name" value="{{ template_name }}">
    <button type="button" class="btn btn-secondary" id="save-template">Save Template</button>
  </div>
  <input type="hidden" name="product_data" id="product_data">
  <input type="hidden" name="include_price" id="include_price" value="yes">
  </form>
  {% endblock %}
  {% block extra_scripts %}
  <script>
    const supply1Products = {{ supply1_products|tojson }};
    const supply2Products = {{ supply2_products|tojson }};
    const baseMaterialUrl = "{{ url_for('material_list') }}";
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="{{ url_for('static', filename='js/material_list.js') }}"></script>
  {% endblock %}
